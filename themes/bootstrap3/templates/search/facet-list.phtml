<? if (!empty($this->sortOptions)): ?>
  <label><?=$this->translate('Sort') ?></label>
  <div class="btn-group">
    <? foreach ($this->sortOptions as $key=>$sort): ?>
      <button class="btn btn-default js-facet-sort<? if($this->sort == $key): ?> active<? endif; ?>" data-sort="<?=$key ?>"><?=$this->translate($sort) ?></button>
    <? endforeach; ?>
  </div>
<? endif; ?>
<div class="full-facet-list list-group">
  <? foreach ($this->data as $item): ?>
    <? $addURL = $this->url('search-results').$this->results->getUrlQuery()->addFacet($this->facet, $item['value'], $item['operator']); ?>
    <a href="<?=$addURL ?>" data-lightbox-ignore class="js-facet-item list-group-item" data-title="<?=$this->escapeHtmlAttr($item['displayText']) ?>" data-count="<?=$item['count'] ?>">
      <? if (!empty($item['displayText'])): ?>
        <?=$this->escapeHtml($item['displayText'])?>
      <? else: ?>
        &nbsp;
      <? endif; ?>
      <span class="badge">
        <?=$this->localizedNumber($item['count'])?>
      </span>
    </a>
  <? endforeach; ?>
  <? if ($this->anotherPage): ?>
    <a href="#nextpage" class="list-group-item js-facet-next-page" data-page="2"><?=$this->translate('more') ?></a>
  <? endif; ?>
</div>
<button class="btn btn-default lightbox-only" data-dismiss="modal"><?=$this->translate('close') ?></button>
<?
  $options = $this->searchOptions($this->searchClassId);
  $facetLightbox = $options->getFacetListAction();
  $url = $this->url($facetLightbox) . $results->getUrlQuery()->getParams().'&facet='.$this->facet;
  $script = <<<JS
(function lightboxFacetSorting() {
  var modal = $('#modal');
  var list = modal.find('.full-facet-list');
  var sortButtons = modal.find('.js-facet-sort');
  function sortAjax(sort) {
    var limit =modal.find('.js-facet-item').length;
    $.ajax('{$url}&layout=lightbox&sort='+sort+'&limit='+limit)
      .done(function facetSortTitleDone(data) {
        list.find('.js-facet-item').remove();
        list.prepend($('<span>'+data+'</span>').find('.js-facet-item'));
      });
    sortButtons.removeClass('active');
  }
  sortButtons.click(function facetSortButton() {
    sortAjax(this.dataset.sort);
    $(this).addClass('active');
  });
}());
$('.js-facet-next-page').click(function facetLightboxMore() {
  var button = $(this);
  var page = parseInt(this.dataset.page);
  if (button.attr('disabled')) {
    return false;
  }
  button.attr('disabled', 1);
  button.text(VuFind.translate('loading')+'...');
  $.ajax('{$url}&layout=lightbox&page='+page)
    .done(function facetLightboxMoreDone(data) {
      var htmlDiv = $('<div>'+data+'</div>');
      button.before(htmlDiv.find('.js-facet-item'));
      if (htmlDiv.find('.js-facet-next-page').length) {
        button.attr('data-page', page + 1);
        button.text(VuFind.translate('more'));
        button.removeAttr('disabled');
      } else {
        button.remove();
      }
    });
  return false;
});
JS;
?>
<?=$this->inlineScript(\Zend\View\Helper\HeadScript::SCRIPT, $script, 'SET'); ?>